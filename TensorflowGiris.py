import pandas as pd

dataFrame = pd.read_excel("bisiklet_fiyatlari.xlsx")

dataFrame.head()
#        Fiyat  BisikletOzellik1  BisikletOzellik2
#   0  807.673876       1749.628226       1749.590668
#   1  959.227520       1748.007826       1751.824206
#   2  718.020033       1750.122967       1747.977026
#   3  945.668885       1749.916440       1750.771646
#   4  955.542968       1750.780519       1750.592430

import seaborn as sbn
import matplotlib.pyplot as plt

sbn.pairplot(dataFrame)


from sklearn.model_selection import train_test_split
# y = wx + b
# y -> label
y = dataFrame["Fiyat"].values

# x -> feature (özellik)
x = dataFrame[["BisikletOzellik1","BisikletOzellik2"]].values

x_train, x_test, y_train, y_test = train_test_split(x,y,test_size=0.33,random_state=15)

x_train.shape
# (670, 2)
x_test.shape
# (330, 2)
y_train.shape
# (670,)
y_test.shape
# (330,)


from sklearn.preprocessing import MinMaxScaler
scaler = MinMaxScaler()
scaler.fit(x_train)

x_train = scaler.transform(x_train)
x_test = scaler.transform(x_test)

x_train
#   array([[0.3177906 , 0.64341466],
#           [0.61991638, 0.89583174],
#           [0.53950097, 0.0980286 ],
#           ...,
#           [0.2352117 , 0.52644765],
#           [0.7576794 , 0.19157421],
#           [0.4292982 , 0.16530301]])


import tensorflow as tf
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense

model = Sequential()

model.add(Dense(4,activation="relu"))
model.add(Dense(4,activation="relu"))
model.add(Dense(4,activation="relu"))

model.add(Dense(1))

model.compile(optimizer = "rmsprop",loss = "mse")

model.fit(x_train,y_train,epochs=250)

loss = model.history.history["loss"]
sbn.lineplot(x=range(len(loss)),y=loss)

trainLoss = model.evaluate(x_train,y_train, verbose=0)
testLoss = model.evaluate(x_test,y_test,verbose=0)

trainLoss
# 76.74778747558594
testLoss
# 75.20804595947266

testTahminleri = model.predict(x_test)
testTahminleri
"""
array([[1077.2782 ],
       [ 626.4545 ],
       [ 876.838  ],
       [ 896.0542 ],
       [ 901.4805 ],
       [ 457.3823 ],
       [ 931.91345],
       [ 991.9772 ],
       [ 940.7816 ],
       [1016.8176 ],
       [ 752.5507 ],
       [ 917.7332 ],
       [ 948.7668 ],
       [1054.1663 ],
       [1119.7072 ],
       [ 684.303  ],
       [1127.0361 ],
       [ 654.821  ],
       [1154.6222 ],
       [ 887.24744],
       [ 893.7292 ],
       [ 718.1236 ],
       [ 459.93112],
       [ 616.1271 ],
       [ 835.7947 ],
       [1090.1512 ],
       [ 716.2864 ],
       [ 759.1283 ],
       [ 875.1084 ],
       [ 772.69305],
       [ 455.9784 ],
       [ 784.25684],
       [ 730.5217 ],
       [ 650.05396],
       [ 887.91284],
       [ 845.2267 ],
       [1035.3387 ],
       [1023.47723],
       [ 845.85175],
       [ 863.7127 ],
       [ 758.886  ],
       [1174.     ],
       [1096.9779 ],
       [1087.0934 ],
       [ 873.12354],
       [ 599.62354],
       [1146.0032 ],
       [ 974.142  ],
       [1042.0753 ],
       [ 858.77124],
       [ 805.89075],
       [ 860.9147 ],
       [ 796.51917],
       [1010.29486],
       [1035.8446 ],
       [ 934.3157 ],
       [ 948.21954],
       [1076.5361 ],
       [ 885.4504 ],
       [1011.01794],
       [ 789.2966 ],
       [ 851.70917],
       [ 729.1421 ],
       [ 895.8895 ],
       [ 971.03265],
       [ 703.28894],
       [ 796.4441 ],
       [ 809.91754],
       [ 858.83167],
       [ 828.5919 ],
       [ 804.5836 ],
       [ 940.0397 ],
       [1059.2993 ],
       [ 946.5267 ],
       [ 989.3291 ],
       [ 669.72046],
       [ 641.71924],
       [ 701.3209 ],
       [ 880.3289 ],
       [ 909.4724 ],
       [ 982.3951 ],
       [ 989.31824],
       [ 616.2903 ],
       [ 864.27057],
       [ 626.8271 ],
       [ 958.6941 ],
       [ 829.25323],
       [ 897.179  ],
       [ 876.6767 ],
       [ 634.63525],
       [ 797.53644],
       [ 712.177  ],
       [1193.2343 ],
       [ 894.17566],
       [ 831.41144],
       [1100.2473 ],
       [ 854.7893 ],
       [ 966.4775 ],
       [ 966.91504],
       [ 442.77722],
       [ 987.4361 ],
       [1062.974  ],
       [ 882.1535 ],
       [1055.5101 ],
       [ 565.77344],
       [ 666.96655],
       [ 858.68915],
       [ 713.3847 ],
       [ 920.54553],
       [ 927.5896 ],
       [ 722.2355 ],
       [ 884.22614],
       [ 981.0558 ],
       [1061.2001 ],
       [ 695.3117 ],
       [ 908.7651 ],
       [ 857.62415],
       [ 868.6275 ],
       [1032.4973 ],
       [ 788.92566],
       [ 714.788  ],
       [ 862.30334],
       [1129.9452 ],
       [ 802.9935 ],
       [ 824.63947],
       [ 898.75867],
       [ 776.2614 ],
       [ 933.4316 ],
       [ 963.38745],
       [ 923.3332 ],
       [ 949.1529 ],
       [1097.9421 ],
       [1031.0255 ],
       [ 802.53705],
       [ 758.5892 ],
       [ 773.8653 ],
       [ 738.99774],
       [ 742.4871 ],
       [ 679.4682 ],
       [1136.6127 ],
       [ 652.5354 ],
       [ 981.7022 ],
       [ 709.20074],
       [ 895.0309 ],
       [ 986.9737 ],
       [ 607.99347],
       [ 744.27094],
       [ 788.5773 ],
       [ 869.6284 ],
       [ 749.29236],
       [ 560.17285],
       [ 637.73346],
       [ 734.44543],
       [1056.4697 ],
       [1109.9161 ],
       [ 902.0557 ],
       [ 717.111  ],
       [ 790.6265 ],
       [ 880.98834],
       [ 956.91144],
       [ 603.3295 ],
       [ 852.7326 ],
       [ 883.00305],
       [ 637.05725],
       [ 917.70074],
       [ 998.6795 ],
       [1183.7587 ],
       [ 804.7054 ],
       [ 742.0466 ],
       [ 962.3095 ],
       [ 717.3281 ],
       [1015.34296],
       [1225.2197 ],
       [ 901.9581 ],
       [ 882.3    ],
       [ 652.7576 ],
       [ 614.05023],
       [ 743.8906 ],
       [ 963.64886],
       [ 702.8904 ],
       [ 766.7063 ],
       [ 817.493  ],
       [ 694.5286 ],
       [ 922.36505],
       [ 873.8623 ],
       [ 615.4712 ],
       [1061.7639 ],
       [ 946.71735],
       [1148.1595 ],
       [ 788.3238 ],
       [ 879.77545],
       [ 659.5516 ],
       [ 670.4182 ],
       [ 735.9263 ],
       [ 686.16595],
       [1081.1165 ],
       [ 786.49115],
       [ 857.46625],
       [1144.3098 ],
       [ 588.8626 ],
       [ 957.10443],
       [ 664.5845 ],
       [ 572.99786],
       [ 750.3395 ],
       [ 598.6722 ],
       [1004.2647 ],
       [1033.9097 ],
       [ 635.3578 ],
       [ 938.7974 ],
       [ 830.3555 ],
       [1134.8105 ],
       [ 919.3015 ],
       [ 888.5598 ],
       [ 977.18524],
       [1035.3165 ],
       [ 878.1274 ],
       [ 852.54926],
       [ 839.19336],
       [ 655.14874],
       [1346.4077 ],
       [ 925.1126 ],
       [ 536.4971 ],
       [ 798.9002 ],
       [ 991.6647 ],
       [ 857.236  ],
       [ 793.56085],
       [ 680.62537],
       [ 792.22534],
       [ 972.3808 ],
       [ 919.2467 ],
       [ 998.86206],
       [ 945.16974],
       [ 905.7335 ],
       [ 744.52765],
       [1060.1149 ],
       [1139.696  ],
       [1011.2943 ],
       [1014.7246 ],
       [ 995.47687],
       [ 852.99866],
       [1010.2601 ],
       [ 630.13477],
       [ 895.8558 ],
       [1066.517  ],
       [ 783.34296],
       [ 571.2912 ],
       [ 611.12   ],
       [ 990.3043 ],
       [ 879.39105],
       [1070.0585 ],
       [ 848.71375],
       [ 745.7133 ],
       [ 547.4752 ],
       [ 874.79846],
       [ 782.45605],
       [ 852.31244],
       [ 889.4998 ],
       [ 911.85785],
       [ 620.06067],
       [1020.9693 ],
       [ 632.3034 ],
       [ 885.9779 ],
       [ 799.50494],
       [ 917.001  ],
       [ 968.1267 ],
       [ 790.63715],
       [ 879.17456],
       [1157.4005 ],
       [1009.55444],
       [ 850.07935],
       [1082.61   ],
       [ 997.12854],
       [ 588.5191 ],
       [ 550.19696],
       [ 973.9606 ],
       [1046.9829 ],
       [ 948.23865],
       [ 904.52637],
       [ 406.02295],
       [1016.6972 ],
       [ 916.3886 ],
       [ 821.5636 ],
       [ 935.6726 ],
       [ 928.0967 ],
       [ 987.1327 ],
       [ 973.98987],
       [ 963.46313],
       [ 619.0048 ],
       [ 971.50165],
       [ 978.16364],
       [ 882.17053],
       [ 856.36053],
       [ 735.4745 ],
       [ 949.4382 ],
       [ 890.5665 ],
       [ 808.11163],
       [ 969.98016],
       [ 836.1319 ],
       [1014.15656],
       [ 608.7031 ],
       [ 576.2247 ],
       [ 723.5613 ],
       [ 807.00073],
       [ 887.5054 ],
       [1220.58   ],
       [ 612.3823 ],
       [1039.4545 ],
       [ 667.6549 ],
       [1126.6415 ],
       [ 801.81445],
       [1212.6024 ],
       [ 790.0294 ],
       [ 646.1455 ],
       [ 896.0834 ],
       [ 924.2919 ],
       [ 845.2365 ],
       [ 670.2122 ],
       [ 989.23035],
       [1090.5007 ],
       [ 777.2843 ],
       [ 897.0214 ],
       [1057.1475 ],
       [ 979.2689 ],
       [ 713.3318 ],
       [ 610.50385],
       [1013.27924],
       [ 793.1401 ],
       [ 767.34717],
       [1166.0924 ],
       [ 805.3695 ]], dtype=float32)
"""

tahminDf = pd.DataFrame(y_test,columns=["Gerçek Y"])
tahminDf
#            Gerçek Y
#   0    1081.652164
#   1     622.675990
#   2     889.356810
#   3     902.826733
#   4     897.662404
#   ..           ...
#   325  1028.438035
#   326   789.934950
#   327   758.490486
#   328  1172.871659
#   329   820.947936

testTahminleri = pd.Series(testTahminleri.reshape(330,))
testTahminleri
#   0      1077.278198
#   1       626.454529
#   2       876.838013
#   3       896.054199
#   4       901.480530
#       
#   325    1013.279236
#   326     793.140076
#   327     767.347168
#   328    1166.092407
#   329     805.369507

tahminDf = pd.concat([tahminDf,testTahminleri],axis=1)
tahminDf
#           Gerçek Y            0
#   0    1081.652164  1077.278198
#   1     622.675990   626.454529
#   2     889.356810   876.838013
#   3     902.826733   896.054199
#   4     897.662404   901.480530
#   ..           ...          ...
#   325  1028.438035  1013.279236
#   326   789.934950   793.140076
#   327   758.490486   767.347168
#   328  1172.871659  1166.092407
#   329   820.947936   805.369507

tahminDf.columns = ["Gerçek Y", "Tahmin Y"]
tahminDf
#           Gerçek Y     Tahmin Y
#   0    1081.652164  1077.278198
#   1     622.675990   626.454529
#   2     889.356810   876.838013
#   3     902.826733   896.054199
#   4     897.662404   901.480530
#   ..           ...          ...
#   325  1028.438035  1013.279236
#   326   789.934950   793.140076
#   327   758.490486   767.347168
#   328  1172.871659  1166.092407
#   329   820.947936   805.369507
sbn.scatterplot(x = "Gerçek Y", y = "Tahmin Y", data = tahminDf)


from sklearn.metrics import mean_absolute_error, mean_squared_error

mean_absolute_error(tahminDf["Gerçek Y"],tahminDf["Tahmin Y"])
# 6.926250708394885
mean_squared_error(tahminDf["Gerçek Y"],tahminDf["Tahmin Y"])
# 75.20804124249204

dataFrame.describe()
#                Fiyat  BisikletOzellik1  BisikletOzellik2
#   count  1000.000000       1000.000000       1000.000000
#   mean    872.677801       1750.024800       1749.964733
#   std     164.124504          1.704531          1.659578
#   min     390.856887       1744.852108       1744.742389
#   25%     757.795031       1748.831119       1748.803186
#   50%     879.168705       1750.017350       1750.003926
#   75%     988.612778       1751.115765       1751.129414
#   max    1355.213745       1755.613884       1754.666038

yeniBisikletOzellikleri = [[1751,1750]]
yeniBisikletOzellikleri = scaler.transform(yeniBisikletOzellikleri)
model.predict(yeniBisikletOzellikleri)
# array([[914.8199]], dtype=float32)


from tensorflow.keras.models import load_model

model.save("bisiklet_modeli.h5")
sonradanCagirilanModel= load_model("bisiklet_modeli.h5")
sonradanCagirilanModel.predict(yeniBisikletOzellikleri)
# array([[914.8199]], dtype=float32)